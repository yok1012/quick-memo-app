# デバッグ設定でのPro版有効化時のクラッシュ修正

## 問題の原因
デバッグ設定でPro版を有効にすると、NotificationManagerが初期化される前に通知スケジュールが実行されることで、メインスレッドとバックグラウンドスレッドの競合状態（race condition）が発生していました。

## 修正内容

### 1. Pro版チェックの強化
- `NotificationManager.scheduleNotifications()`の冒頭でPro版チェックを追加
- Pro版でない場合は早期リターン

### 2. 初期化タイミングの調整
- アプリ起動時の通知スケジュールの遅延を0.5秒から1.0秒に延長
- スケジュール実行前にPro版状態を再チェック

### 3. Pro版状態変更時の処理
- NotificationManagerにPro版状態変更の監視を追加
- Pro版が無効になった場合、自動的に通知をキャンセル

### 4. デバッグ設定での安全性向上
- Pro版切り替え時にログ出力を追加
- Pro版無効化時に通知設定も自動的に無効化

### 5. スレッドセーフティの改善
- 通知スケジューリングのカウンター処理をスレッドセーフに変更
- DispatchQueueを使用した適切な同期処理

## テスト手順
1. デバッグ設定を開く
2. デバッグモードを有効化
3. Pro版として動作をオン/オフ切り替え
4. クラッシュしないことを確認
5. 設定画面で通知設定がPro版状態に応じて表示/非表示されることを確認

## 注意事項
- Pro版状態の変更は即座に反映される
- 通知権限がない場合は通知スケジュールは実行されない
- バックグラウンドでの通知スケジュールは非同期で実行される